<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DRM DASH M3U Player</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.8/shaka-player.compiled.js"></script>
<style>
  body { font-family: Arial; margin: 20px; }
  #player { width: 100%; max-width: 800px; height: 450px; background: black; }
  #playlist { margin-top: 20px; }
  button { display: block; margin: 5px 0; padding: 10px; }
</style>
</head>
<body>

<h1>DRM DASH M3U Player</h1>
<video id="player" controls autoplay></video>

<div id="playlist"></div>

<script>
// Example parsed M3U (replace with dynamic parsing if needed)
const channels = [
  {
    name: "Nakshatra Digital TV",
    logo: "https://jiotvimages.cdn.jio.com/dare_images/images/Nakshatra_Digital_TV.png",
    url: "https://jiotvpllive.cdn.jio.com/bpk-tv/Nakshatra_Digital_TV_BTS/output/index.mpd?__hdnea__=st=1762735638~exp=1762822038~acl=/*~hmac=951e44e4a288c899683e83e82cf7a9359e11fbe81264f59d051d51a382de5acd",
    clearkey: { "37b9a46068985672ba01da4d0e1e0230": "7403aedf707ddf0607f96ba367f5306a" },
    headers: { "cookie": "__hdnea__=st=1762735638~exp=1762822038~acl=/*~hmac=951e44e4a288c899683e83e82cf7a9359e11fbe81264f59d051d51a382de5acd" }
  },
  {
    name: "RRN News",
    logo: "https://jiotvimages.cdn.jio.com/dare_images/images/RRN_News.png",
    url: "https://jiotvpllive.cdn.jio.com/bpk-tv/RRN_News_BTS/output/index.mpd?__hdnea__=st=1762735638~exp=1762822038~acl=/*~hmac=951e44e4a288c899683e83e82cf7a9359e11fbe81264f59d051d51a382de5acd",
    clearkey: { "aef474fb421b516297325c8684411722": "3bfb218ddf6704641bfe205c0887c283" },
    headers: { "cookie": "__hdnea__=st=1762735638~exp=1762822038~acl=/*~hmac=951e44e4a288c899683e83e82cf7a9359e11fbe81264f59d051d51a382de5acd" }
  }
];

// Initialize Shaka Player
const video = document.getElementById('player');
const player = new shaka.Player(video);

// Error handling
player.addEventListener('error', e => console.error('Error code', e.detail.code, e.detail));

function playChannel(channel) {
  const manifestUri = channel.url;

  // Configure ClearKey DRM
  player.configure({
    drm: {
      clearKeys: channel.clearkey
    },
    streaming: {
      retryParameters: { maxAttempts: 3, baseDelay: 1000, backoffFactor: 2 }
    }
  });

  // Custom headers
  player.getNetworkingEngine().registerRequestFilter((type, request) => {
    if (type === shaka.net.NetworkingEngine.RequestType.MANIFEST ||
        type === shaka.net.NetworkingEngine.RequestType.SEGMENT) {
      for (const key in channel.headers) {
        request.headers[key] = channel.headers[key];
      }
    }
  });

  player.load(manifestUri).then(() => {
    console.log(`${channel.name} loaded successfully`);
  }).catch(err => console.error('Load error', err));
}

// Render playlist buttons
const playlistDiv = document.getElementById('playlist');
channels.forEach(channel => {
  const btn = document.createElement('button');
  btn.innerHTML = channel.name;
  btn.onclick = () => playChannel(channel);
  playlistDiv.appendChild(btn);
});

// Play first channel by default
playChannel(channels[0]);
</script>

</body>
</html>
